<% if(articles.length){%>
    <h1 class="display-1">Vos Articles</h1>
    <div class="row justify-content-evenly gap-1">
        <%articles.forEach((n)=>{%>
            <div class="card border-dark p-0 mb-2 col-12 col-md-8 col-lg-4 col-xl-3 shadow-lg">
                <div class="card-header bg-dark bg-gradient d-flex justify-content-between">
                    <h5 class="card-title text-primary">
                        <%=n.titre%>
                    </h5>
                    <h6 class="display-10 rounded bg-success text-white p-1 border">
                        <%=n.type.nom%>
                    </h6>
                </div>
                <div class="overflow-hidden position-relative h-100">
                    <img class="h-100 w-100" src="<%= n.image ? n.image : " /images/preset/error.jpg" %>" alt="
                    <%=n.titre%>">
                </div>
                <div class="card-footer d-flex justify-content-center gap-3 text-white bg-dark bg-gradient">
                    <a class="btn btn-outline-primary" title="Voir plus" href="articles/<%=n.id%>">
                        <i class="bi bi-search"></i>
                    </a>
                    <a href="articles/<%=n.id%>/edit" class="btn btn-outline-success" title="Modifier">
                        <i class="bi bi-pencil-square"></i>
                    </a>
                    <button class="btn btn-outline-danger btn-supprimer" title="Supprimer" data-id="<%= n.id %>">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <%})}else{%>
                <div
                    class="alert alert-info py-3 px-2 border border-warning position-absolute top-50 start-50 translate-middle py-4 px-2">
                    <h1 class="display-1">Il n'y a rien</h1>
                    <p>Vous n'avez pas encore ajouter d'articles</p>
                    <a href="/articles/new" class="btn btn-warning">Ajouter un Article</a>
                    <a href="/types/new" class="btn btn-warning">Ajouter une catégorie</a>
                </div>
                <%}%>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const boutonsSupprimer = document.querySelectorAll('.btn-supprimer');

            boutonsSupprimer.forEach(bouton => {
                bouton.addEventListener('click', async () => {
                    const id = bouton.getAttribute('data-id');

                    // confirmation utilisateur
                    if (!confirm("Voulez-vous vraiment supprimer cet article ?")) return;

                    try {
                        const response = await fetch(`/articles/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                        bouton.closest('.card').remove();
                    } catch (error) {
                        console.error("Erreur fetch :", error);
                        alert("Erreur réseau.");
                    }
                });
            });
        });
    </script>